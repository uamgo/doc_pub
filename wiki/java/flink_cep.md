# Flink CEP

## 目标

* 了解 Flink CEP 的基本使用方式
* 熟悉 Flink CEP 常规优化方式

## 详细内容

* CEP 概念
  * 复杂事件处理（Complex Event Processing）用于识别输入流中符合指定规则的事件，并按照指定方式输出。
* 使用场景
  * 风险控制，异常行为检测，异常频率
  * 策略营销，用预先定义好的规则跟踪用户行为
  * 运维监控，比如同一张信用卡不同地方，同一时刻刷两次
* 模式
  * 个体模式
    * Ø单例模式：只接收一个事件 p 触发条件 (.where()/.or()/.until())
    * Ø循环模式：可以接收一个或多个事件 p 单例 +量词（在个体模式后追加量词，指定循环次数）
  * 组合模式（多个个体模式的组合）
    * 严格连续(next)，中间没有任何不匹配的事件
    * 宽松连续(followBy)，忽略匹配的事件之间的不匹配的事件
    * 不确定的宽松连续(followByAny)，一个匹配的事件能够再次使用
* 场景
  * 电商15分钟内一定要付款，否则取消
    * 首先，使用begin()方法以模式作为开始；
    * 其次，由于创建的CEP规则是 创建订单—>支付完成 ，则在单例模式下，通过where条 件触发订单的状态已将处于 1 创建订单，等待支付状态
    * 接着，通过宽松连续followBy()方法忽略15分钟内的产生的其他订单，所以使用宽松连续。
    * 然后，通过where条件触发订单的状态是否已将处于 2 支付完成。
    * 最后，通过within()方法判断第二次触发的订单是否在支付的15分钟内完成。
  * 系统登录案例——当2秒内出现两次登录失败（“fail”）时，输出异常报警信息
    * begin: 第一次；
    * where: 出现 fail；
    * next： 紧接着第二次出现 fail；
    * times: 出现一次 ；
    * within:表示在2秒内

## 文章引用

[Flink CEP 详细介绍](https://zhuanlan.zhihu.com/p/399726869)

